/**
 * This file is part of ILIAS, a powerful learning management system
 * published by ILIAS open source e-Learning e.V.
 *
 * ILIAS is licensed with the GPL-3.0,
 * see https://www.gnu.org/licenses/gpl-3.0.en.html
 * You should have received a copy of said license along with the
 * source code, too.
 *
 * If this is not the case or you just want to try ILIAS, you'll find
 * us at:
 * https://www.ilias.de
 * https://github.com/ILIAS-eLearning
 */
!function(e){"use strict";const t="1:1",n="n:n",o="source_area",s="ilMatchingQuestionTerm",l="c-test__definition",c="c-test__term",i="c-test__dropzone";let r,a,d;function u(e,t,l){r===n&&function(e,t,n){n.parentNode.classList.contains(s)&&n.remove(),t.parentNode.classList.contains(o)&&e.remove()}(e,t,l)}function f(){a.querySelectorAll(`.${s}`).forEach((e=>{var n;r!==t?null!==(n=e).firstElementChild&&n.lastElementChild.classList.contains(i)||n.append(d.cloneNode()):function(e){const t=e.firstElementChild;null!==t?t.classList.contains(c)&&null!==t.nextElementSibling&&t.nextElementSibling.remove():e.prepend(d.cloneNode())}(e)}))}function h(e,t,n,c){!function(e,t,n){const c=e.dataset;if(!n.classList.contains(o)){const e=n.closest(`.${l}`).querySelector("input"),t=JSON.parse(e.value),o=t.indexOf(c.id);o>-1&&t.splice(o,1),e.value=JSON.stringify(t)}if(t.parentNode.classList.contains(s)){const e=t.closest(`.${l}`),n=JSON.parse(e.querySelector("input").value);n.push(c.id),e.querySelector("input").value=JSON.stringify(n)}}(e,t,c),u(e,t,n)}function v(e){f();const t=a.querySelector(`.${o}`);null!==t.firstElementChild&&t.firstElementChild.classList.contains(i)||t.prepend(d.cloneNode()),e.parentNode.querySelectorAll(`.${i}`).forEach((e=>{e.remove()})),r===n&&a.querySelectorAll(`.${s}`).forEach((t=>{null!==t.lastElementChild&&t.lastElementChild.classList.contains(i)||t.append(d.cloneNode()),null!==t.querySelector(`[data-id='${e.dataset.id}']`)&&t.querySelector(`.${i}`)?.remove()}))}function p(e,n,o){a=e,r=o,function(){const e=a.querySelectorAll(`.${c}`);let t=0;e.forEach((e=>{e.offsetHeight<t&&(t=e.offsetHeight)})),a.querySelectorAll(`.${i}`).forEach((t=>{t.style.height=`${e.item(0).offsetHeight}px`})),d=a.querySelector(`.${i}`)}(),n(r===t?"move":"copy",a,c,i,h,v)}const m="c-test__dropzone--active",g="c-test__dropzone--hover";let E,y,L,S,$,q,N,A,x;function _(e){setTimeout((()=>{T(e.target),e.dataTransfer.dropEffect=E,e.dataTransfer.effectAllowed=E,e.dataTransfer.setDragImage(N,0,0)}),0)}function D(e){e.preventDefault(),e.stopPropagation(),T(e.target.closest(`.${L}`));const t=N.offsetWidth,n=N.offsetHeight;A=N.cloneNode(!0),N.parentNode.insertBefore(A,N),N.style.position="fixed",N.style.left=e.touches[0].clientX-t/2+"px",N.style.top=e.touches[0].clientY-n/2+"px",N.style.width=`${t}px`,N.style.height=`${n}px`,N.addEventListener("touchmove",Y),N.addEventListener("touchend",J)}function T(e){N=e,N.style.opacity=.5,q(N),y.querySelectorAll(`.${S}`).forEach((e=>{P(e),e.classList.add(m)})),N.querySelectorAll(`.${S}`).forEach((e=>{e.classList.remove(m)}))}function Y(e){e.preventDefault(),N.style.left=e.touches[0].clientX-N.offsetWidth/2+"px",N.style.top=e.touches[0].clientY-N.offsetHeight/2+"px";const{documentElement:t}=y.ownerDocument;e.touches[0].clientY>.8*t.clientHeight&&t.scroll({left:0,top:.8*e.touches[0].pageY,behavior:"smooth"}),e.touches[0].clientY<.2*t.clientHeight&&t.scroll({left:0,top:.8*e.touches[0].pageY,behavior:"smooth"});const n=y.ownerDocument.elementsFromPoint(e.changedTouches[0].clientX,e.changedTouches[0].clientY).filter((e=>e.classList.contains(S)));0===n.length&&void 0!==x&&(x.classList.remove(g),x=void 0),1===n.length&&x!==n[0]&&(void 0!==x&&x.classList.remove(g),[x]=n,x.classList.add(g))}function C(e){e.preventDefault()}function H(e){e.target.classList.add(g)}function b(e){e.target.classList.remove(g)}function w(){N.removeAttribute("style"),y.querySelectorAll(`.${S}`).forEach((e=>{e.classList.remove(m),e.classList.remove(g)}))}function O(e){e.preventDefault(),X(e.target)}function J(e){e.preventDefault();const t=y.ownerDocument.elementsFromPoint(e.changedTouches[0].clientX,e.changedTouches[0].clientY).filter((e=>e.classList.contains(S)));w(),A.remove(),1===t.length&&X(t[0])}function X(e){const t=N.parentNode;let n=N;"move"!==E&&(n=N.cloneNode(!0),n.style.opacity=null,z(n)),e.parentNode.insertBefore(n,e),$(n,e,N,t)}function z(e){e.addEventListener("dragstart",_),e.addEventListener("dragend",w),e.addEventListener("touchstart",D)}function P(e){e.removeEventListener("dragover",C),e.removeEventListener("dragenter",H),e.removeEventListener("dragleave",b),e.removeEventListener("drop",O),e.addEventListener("dragover",C),e.addEventListener("dragenter",H),e.addEventListener("dragleave",b),e.addEventListener("drop",O)}function B(e,t,n,o,s,l){E=e,y=t,L=n,S=o,$=s,q=l,y.querySelectorAll(`.${L}`).forEach(z),y.querySelectorAll(`.${S}`).forEach(P)}e.test=e.test||{},e.test.matching=e.test.matching||{},e.test.matching.init=(e,t)=>p(e,B,t)}(il);
