/**
 * This file is part of ILIAS, a powerful learning management system
 * published by ILIAS open source e-Learning e.V.
 *
 * ILIAS is licensed with the GPL-3.0,
 * see https://www.gnu.org/licenses/gpl-3.0.en.html
 * You should have received a copy of said license along with the
 * source code, too.
 *
 * If this is not the case or you just want to try ILIAS, you'll find
 * us at:
 * https://www.ilias.de
 * https://github.com/ILIAS-eLearning
 */
!function(e){"use strict";const t="more",n=500;let o,i;function r(e,t,n){const o=document.createElement("li");return o.tabIndex=0,o.textContent=e,o.dataset.value=t,void 0!==n&&(o.dataset.id=n),o}function a(e){"UL"===e.nextElementSibling?.nodeName&&e.nextElementSibling.remove()}function l(){"number"==typeof i&&(window.clearTimeout(i),i=void 0)}async function u(e,n,i){try{const{signal:l}=o,u=await fetch(e,{signal:l});if(!u.ok)throw new Error(`Response status: ${u.status}`);const s=await u.json(),m=function(e){if(void 0===e.items)return e;const t=[];return Object.entries(e.items).forEach((([e,n])=>{t[e]=n})),t}(s);if(0===m.length)return void a(n);const g=document.createElement("ul");if(g.style.left=`${n.offsetLeft}px`,g.style.minWidth=`${n.offsetWidth}px`,g.classList.add("c-form__autocomplete"),m.forEach((e=>{n.value!==e.value&&n.value.includes(e.value)||g.appendChild(r(e.label,e.value,e.id))})),s.hasMoreResults&&g.appendChild(r(i.moreText,t)),0===g.children.length)return;g.addEventListener("keydown",(e=>{d(e,i)})),g.addEventListener("click",(e=>{c(e,i)}));const p=document.activeElement.dataset.value;a(n),n.parentNode.appendChild(g),void 0!==p&&n.parentNode.querySelector(`[data-value="${p}"]`).focus()}catch(e){}}function d(e,t){"Enter"===e.key&&"LI"===e.target.nodeName&&(e.preventDefault(),c(e,t)),"ArrowDown"===e.key&&(e.stopImmediatePropagation(),e.preventDefault(),"UL"===e.target.nextElementSibling?.nodeName&&e.target.nextElementSibling.firstElementChild.focus(),"LI"===e.target.nodeName&&null!==e.target.nextElementSibling&&e.target.nextElementSibling.focus()),"ArrowUp"===e.key&&"LI"===e.target.nodeName&&(e.stopImmediatePropagation(),e.preventDefault(),null===e.target.previousElementSibling?e.target.parentElement.previousElementSibling.focus():e.target.previousElementSibling.focus())}function s(e,t){return null===t?e.trim():e.split(t).at(-1).trim()}function c(e,n){o.abort(),o=new AbortController;let{value:i}=e.target.dataset;if(i!==t){if(null!==n.delimiter){const t=e.target.parentNode.previousElementSibling.value.split(n.delimiter);let o="";t.length>1&&(o=`${t.slice(0,-1).join(`${n.delimiter} `)}${n.delimiter} `),i=`${o}${i}${n.delimiter} `}e.target.parentNode.previousElementSibling.value=i,e.target.parentNode.previousElementSibling.focus(),e.target.parentNode.remove(),n.submitOnSelection&&"id"in e.target.dataset&&(window.location.href=`${n.submitUrl}&selected_id=${encodeURIComponent(e.target.dataset.id)}`)}else{const t=s(e.target.parentNode.previousElementSibling.value,n.delimiter);u(`${n.dataSource}&term=${encodeURIComponent(t)}&fetchall=1`,e.target.parentNode.previousElementSibling,n)}}function m(e,t){o=new AbortController,function(e){const t=document.createAttribute("role");t.value="status",e.setAttributeNode(t);const n=document.createAttribute("aria-relevant");n.value="additions",e.setAttributeNode(n)}(e.parentElement),e.addEventListener("keydown",(e=>{d(e,t)})),e.addEventListener("keyup",(e=>{!function(e,t){if(void 0===e.key||"Tab"===e.key||"ArrowDown"===e.key||"ArrowUp"===e.key)return;if(e.target.value.length<t.autocompleteLength)return l(),void a(e.target);const o=s(e.target.value,t.delimiter);l(),i=window.setTimeout((()=>{u(`${t.dataSource}&term=${encodeURIComponent(o)}`,e.target,t)}),n)}(e,t)}))}e.LegacyForm=e.LegacyForm||{},e.LegacyForm.autocomplete=e.LegacyForm.autocomplete||{},e.LegacyForm.autocomplete.init=(e,t)=>m(e,t)}(il);
