/**
 * This file is part of ILIAS, a powerful learning management system
 * published by ILIAS open source e-Learning e.V.
 *
 * ILIAS is licensed with the GPL-3.0,
 * see https://www.gnu.org/licenses/gpl-3.0.en.html
 * You should have received a copy of said license along with the
 * source code, too.
 *
 * If this is not the case or you just want to try ILIAS, you'll find
 * us at:
 * https://www.ilias.de
 * https://github.com/ILIAS-eLearning
 */
!function(e){"use strict";const t="more",n=500;let i,o;function a(e,t,n){const i=document.createElement("li");return i.tabIndex=0,i.textContent=e,i.dataset.value=t,void 0!==n&&(i.dataset.id=n),i}function r(e){"UL"===e.nextElementSibling?.nodeName&&e.nextElementSibling.remove()}function l(){"number"==typeof o&&(window.clearTimeout(o),o=void 0)}async function u(e,n,o){try{const{signal:l}=i,u=await fetch(e,{signal:l});if(!u.ok)throw new Error(`Response status: ${u.status}`);const c=await u.json(),m=function(e){if(void 0===e.items)return e;const t=[];return Object.entries(e.items).forEach((([e,n])=>{t[e]=n})),t}(c);if(0===m.length)return void r(n);const g=document.createElement("ul");if(g.style.left=`${n.offsetLeft}px`,g.style.minWidth=`${n.offsetWidth}px`,g.classList.add("c-form__autocomplete"),m.forEach((e=>{n.value!==e.value&&n.value.includes(e.value)||g.appendChild(a(e.label,e.value,e.id))})),c.hasMoreResults&&g.appendChild(a(o.moreText,t)),0===g.children.length)return;g.addEventListener("keydown",(e=>{d(e,o)})),g.addEventListener("click",(e=>{s(e,o)}));const p=document.activeElement.dataset.value;r(n),n.parentNode.appendChild(g),void 0!==p&&n.parentNode.querySelector(`[data-value="${p}"]`).focus()}catch(e){}}function d(e,t){"Enter"===e.key&&"LI"===e.target.nodeName&&(e.preventDefault(),s(e,t)),"ArrowDown"===e.key&&(e.stopImmediatePropagation(),e.preventDefault(),"UL"===e.target.nextElementSibling?.nodeName&&e.target.nextElementSibling.firstElementChild.focus(),"LI"===e.target.nodeName&&null!==e.target.nextElementSibling&&e.target.nextElementSibling.focus()),"ArrowUp"===e.key&&"LI"===e.target.nodeName&&(e.stopImmediatePropagation(),e.preventDefault(),null===e.target.previousElementSibling?e.target.parentElement.previousElementSibling.focus():e.target.previousElementSibling.focus())}function s(e,n){i.abort();let{value:o}=e.target.dataset;if(o!==t){if(null!==n.delimiter){const t=e.target.parentNode.previousElementSibling.value.split(n.delimiter);let i="";t.length>1&&(i=t.slice(0,-1).join(n.delimiter+" ")+n.delimiter+" "),o=i+o+n.delimiter+" "}e.target.parentNode.previousElementSibling.value=o,e.target.parentNode.previousElementSibling.focus(),e.target.parentNode.remove(),i=new AbortController,n.submitOnSelection&&"id"in e.target.dataset&&(window.location.href=`${n.submitUrl}&selected_id=${encodeURIComponent(e.target.dataset.id)}`)}else u(`${n.dataSource}&fetchall=1`,e.target.parentNode.previousElementSibling,n)}function c(e,t){i=new AbortController,function(e){const t=document.createAttribute("role");t.value="status",e.setAttributeNode(t);const n=document.createAttribute("aria-relevant");n.value="additions",e.setAttributeNode(n)}(e.parentElement),e.addEventListener("keydown",(e=>{d(e,t)})),e.addEventListener("keyup",(e=>{!function(e,t){if(void 0===e.key||"Tab"===e.key||"ArrowDown"===e.key||"ArrowUp"===e.key)return;if(e.target.value.length<t.autocompleteLength)return l(),void r(e.target);let i=e.target.value.trim();null!==t.delimiter&&(i=i.split(t.delimiter).at(-1).trim()),l(),o=window.setTimeout((()=>{u(`${t.dataSource}&term=${encodeURIComponent(i)}`,e.target,t)}),n)}(e,t)}))}e.LegacyForm=e.LegacyForm||{},e.LegacyForm.autocomplete=e.LegacyForm.autocomplete||{},e.LegacyForm.autocomplete.init=(e,t)=>c(e,t)}(il);
